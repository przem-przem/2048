const e=e=>{z.innerHTML=e?"You win :)":"You lose :(",R.classList.remove(Y),F.innerHTML=`Your score:  ${t}`};let t=0;const l=document.getElementById("score");class s{#e;#t;#l;#s;#n;constructor(e,t,l){this.#e=e,this.#t=t,this.#l=l}get x(){return this.#t}get y(){return this.#l}get tile(){return this.#s}get mergeTile(){return this.#n}set mergeTile(e){this.#n=e,null!=e&&(this.#n.x=this.#t,this.#n.y=this.#l)}set tile(e){this.#s=e,null!=e&&(this.#s.x=this.#t,this.#s.y=this.#l)}canAccept(e){return null==this.tile||null==this.mergeTile&&this.tile.value===e.value}mergeTiles(){null!=this.mergeTile&&null!=this.tile&&(this.tile.value=this.tile.value+this.mergeTile.value,"number"==typeof this.tile.value&&n(this.tile.value),this.tile.value==1024*q&&e(!0),this.mergeTile.remove(),this.mergeTile=null)}}const n=e=>{t+=e,l.innerHTML=`Score:  ${t}`};class i{#i;constructor(e,t){e.style.setProperty("--grid-size",t),e.style.setProperty("--cell-size",`${W}vmin`),e.style.setProperty("--cell-gap","2vmin"),this.#i=r(e,t).map(((e,l)=>new s(e,l%t,Math.floor(l/t))))}get cellsByColumn(){return this.#i.reduce(((e,t)=>(e[t.x]=e[t.x]||[],e[t.x][t.y]=t,e)),[])}get cellsByRow(){return this.#i.reduce(((e,t)=>(e[t.y]=e[t.y]||[],e[t.y][t.x]=t,e)),[])}get cells(){return this.#i}get#r(){return this.#i.filter((e=>null==e.tile))}randomEmptyCell(){const e=Math.floor(Math.random()*this.#r.length);return this.#r[e]}}const r=(e,t)=>{const l=[];for(let s=0;s<t*t;s++){const t=document.createElement("div");t.classList.add("cell"),t.setAttribute("id","cell"),l.push(t),e.append(t)}return l},o=["#a7d0cd","#b8c0b8","#bfb2a7","#c1a49a","#bf988f","#b98c86","#b18180","#a7787c","#9a6f7a","#8c6779","#7b6079"];class c{#o;#t;#l;#c;constructor(e,t=(Math.random()>.5?q:2*q)){this.#o=document.createElement("div"),this.#o.classList.add("tile"),this.#o.setAttribute("id","tile"),e.append(this.#o),this.value=t}set x(e){this.#t=e,this.#o.style.setProperty("--x",e)}set y(e){this.#l=e,this.#o.style.setProperty("--y",e)}get value(){return this.#c}set value(e){this.#c=e,this.#o.textContent=e;const t=Math.log2(e),l=Math.floor(t);this.#o.style.setProperty("background-color",o[l-1]),l>=8&&this.#o.style.setProperty("color","#F5F5F5"),3==_?(this.#o.style.setProperty("border-radius","8vmin"),this.#o.style.setProperty("font-size","6vmin")):4==_?(this.#o.style.setProperty("border-radius","6vmin"),this.#o.style.setProperty("font-size","5vmin")):5==_&&(this.#o.style.setProperty("border-radius","5vmin"),this.#o.style.setProperty("font-size","4vmin"))}remove(){this.#o.remove()}waitForTransition(e=!1){return new Promise((t=>{this.#o.addEventListener(e?"animationend":"transitionend",t,{once:!0})}))}}const a=async l=>{let s;switch("object"==typeof l?s=l.key:"string"==typeof l&&(s=l),s){case"ArrowUp":if(!y())return void D();await u();break;case"ArrowDown":if(!p())return void D();await d();break;case"ArrowLeft":if(!v())return void D();await m();break;case"ArrowRight":if(!E())return void D();await g();break;default:return void D()}if($.cells.forEach((e=>e.mergeTiles())),!R.classList.contains(Y))return void(F.innerHTML=`Your score:  ${t}`);const n=new c(T);$.randomEmptyCell().tile=n,U[0].length=0,U[1].length=1,y()||p()||v()||E()?D():n.waitForTransition(!0).then((()=>{e(!1)}))},u=()=>{h($.cellsByColumn)},m=()=>{h($.cellsByRow)},d=()=>{h($.cellsByColumn.map((e=>[...e].reverse())))},g=()=>{h($.cellsByRow.map((e=>[...e].reverse())))},h=e=>Promise.all(e.flatMap((e=>{const t=[];for(let l=1;l<e.length;l++){const s=e[l];if(null==s.tile)continue;let n;for(let t=l-1;t>=0;t--){const l=e[t];if(!l.canAccept(s.tile))break;n=l}null!=n&&(t.push(s.tile.waitForTransition()),null!=n.tile?n.mergeTile=s.tile:n.tile=s.tile,s.tile=null)}return t}))),y=()=>f($.cellsByColumn),p=()=>f($.cellsByColumn.map((e=>[...e].reverse()))),v=()=>f($.cellsByRow),E=()=>f($.cellsByRow.map((e=>[...e].reverse()))),f=e=>e.some((e=>e.some(((t,l)=>{if(0==l)return!1;if(null==t.tile)return!1;return e[l-1].canAccept(t.tile)})))),w=document.getElementById("rangeInput"),L=document.getElementById("rangeBubble"),b=document.getElementById("main"),B=document.getElementById("title"),T=document.getElementById("game-board"),I=Array.from(document.querySelectorAll('input[name="gridSize"]')),x=(Array.from(document.querySelectorAll('input[name="baseNumber"]')),document.getElementById("rangeInput")),A=document.getElementById("rangeBubble"),M=document.getElementById("openSettings"),C=document.getElementById("closeSettings"),P=document.getElementById("tapToStart"),k=document.getElementById("settings-board"),S=document.getElementById("starter-board"),H=document.getElementById("score"),R=(document.getElementById("tile"),document.getElementById("endgame__board")),z=document.getElementById("endgame__title"),F=document.getElementById("endgame__score"),Y="hidden";let $="",_=4,W=15,q=2;M.addEventListener("click",(function(){k.classList.toggle(Y),P.classList.toggle(Y),M.classList.toggle(Y),(()=>{L.innerHTML=w.value;const e=w.offsetWidth/10*w.value-w.offsetWidth/10+4;L.style.left=`${e}px`})()})),C.addEventListener("click",(function(){k.classList.toggle(Y),P.classList.toggle(Y),M.classList.toggle(Y)})),P.addEventListener("click",(function(){M.classList.toggle(Y),S.classList.toggle(Y),P.classList.toggle(Y),b.classList.toggle(Y),H.classList.toggle(Y),$=new i(T,_),$.randomEmptyCell().tile=new c(T),$.randomEmptyCell().tile=new c(T),D()})),window.addEventListener("keyup",(e=>{"Space"!=e.code&&"Enter"!=e.code||(M.classList.toggle(Y),P.classList.toggle(Y),b.classList.toggle(Y),H.classList.toggle(Y),$=new i(T),$.randomEmptyCell().tile=new c(T),$.randomEmptyCell().tile=new c(T),D())})),x.addEventListener("input",(()=>{A.innerHTML=x.value;const e=x.offsetWidth/10*x.value-x.offsetWidth/10+4;A.style.left=`${e}px`,q=parseInt(x.value),B.innerHTML=1024*q}));for(let e of I)e.addEventListener("click",(t=>{_=e.value,3==e.value?(_=3,W=18):4==e.value?(_=4,W=15):5==e.value&&(_=5,W=11)}));const D=()=>{window.addEventListener("keydown",a,{once:!0})};var U=[[],[]];window.addEventListener("touchstart",(function(e){U[0].push(e.changedTouches[0].screenX),U[1].push(e.changedTouches[0].screenY)})),window.addEventListener("touchend",(function(e){U[0].push(e.changedTouches[0].screenX),U[1].push(e.changedTouches[0].screenY);const t=(()=>{const e=U[0][1]-U[0][0],t=U[1][1]-U[1][0];return Math.abs(e)>Math.abs(t)?e>0?"ArrowRight":"ArrowLeft":t>0?"ArrowDown":"ArrowUp"})();a(t)}));
//# sourceMappingURL=index.03b1d8de.js.map
