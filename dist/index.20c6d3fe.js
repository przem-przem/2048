let e=0;const t=document.getElementById("score");class l{#e;#t;#l;#s;#i;constructor(e,t,l){this.#e=e,this.#t=t,this.#l=l}get x(){return this.#t}get y(){return this.#l}get tile(){return this.#s}get mergeTile(){return this.#i}set mergeTile(e){this.#i=e,null!=e&&(this.#i.x=this.#t,this.#i.y=this.#l)}set tile(e){this.#s=e,null!=e&&(this.#s.x=this.#t,this.#s.y=this.#l)}canAccept(e){return null==this.tile||null==this.mergeTile&&this.tile.value===e.value}mergeTiles(){null!=this.mergeTile&&null!=this.tile&&(this.tile.value=this.tile.value+this.mergeTile.value,"number"==typeof this.tile.value&&s(this.tile.value),this.mergeTile.remove(),this.mergeTile=null)}}const s=l=>{e+=l,t.innerHTML=`Score:  ${e}`};const i=e=>{const t=[];for(let l=0;l<16;l++){const l=document.createElement("div");l.classList.add("cell"),t.push(l),e.append(l)}return t},r=["#a7d0cd","#b8c0b8","#bfb2a7","#c1a49a","#bf988f","#b98c86","#b18180","#a7787c","#9a6f7a","#8c6779","#7b6079"];class n{#r;#t;#l;#n;constructor(e,t=(Math.random()>.5?3:6)){this.#r=document.createElement("div"),this.#r.classList.add("tile"),e.append(this.#r),this.value=t}set x(e){this.#t=e,this.#r.style.setProperty("--x",e)}set y(e){this.#l=e,this.#r.style.setProperty("--y",e)}get value(){return this.#n}set value(e){this.#n=e,this.#r.textContent=e;const t=Math.log2(e),l=Math.floor(t);this.#r.style.setProperty("background-color",r[l-1]),l>=8&&this.#r.style.setProperty("color","#F5F5F5")}remove(){this.#r.remove()}waitForTransition(e=!1){return new Promise((t=>{this.#r.addEventListener(e?"animationend":"transitionend",t,{once:!0})}))}}const o=document.getElementById("game-board"),c=()=>{window.addEventListener("keydown",u,{once:!0})};let a=[[],[]];o.addEventListener("touchstart",(function(e){a[0].push(e.changedTouches[0].screenX),a[1].push(e.changedTouches[0].screenY)})),o.addEventListener("touchend",(function(e){a[0].push(e.changedTouches[0].screenX),a[1].push(e.changedTouches[0].screenY);const t=h();u(t)}));const h=()=>{console.log(a[0]),console.log(a[1]);const e=a[0][1]-a[0][0];console.log(e);const t=a[1][1]-a[1][0];return console.log(t),Math.abs(e)>Math.abs(t)?e>0?"ArrowRight":"ArrowLeft":t>0?"ArrowDown":"ArrowUp"},u=async e=>{let t;switch("object"==typeof e?t=e.key:"string"==typeof e&&(t=e),console.log(t),t){case"ArrowUp":if(!v())return void c();await m();break;case"ArrowDown":if(!w())return void c();await d();break;case"ArrowLeft":if(!f())return void c();await y();break;case"ArrowRight":if(!E())return void c();await g();break;default:return void c()}b.cells.forEach((e=>e.mergeTiles()));const l=new n(o);b.randomEmptyCell().tile=l,a=[[],[]],v()||w()||f()||E()?c():l.waitForTransition(!0).then((()=>{alert("You lose")}))},m=()=>{p(b.cellsByColumn)},y=()=>{p(b.cellsByRow)},d=()=>{p(b.cellsByColumn.map((e=>[...e].reverse())))},g=()=>{p(b.cellsByRow.map((e=>[...e].reverse())))},p=e=>Promise.all(e.flatMap((e=>{const t=[];for(let l=1;l<e.length;l++){const s=e[l];if(null==s.tile)continue;let i;for(let t=l-1;t>=0;t--){const l=e[t];if(!l.canAccept(s.tile))break;i=l}null!=i&&(t.push(s.tile.waitForTransition()),null!=i.tile?i.mergeTile=s.tile:i.tile=s.tile,s.tile=null)}return t}))),v=()=>T(b.cellsByColumn),w=()=>T(b.cellsByColumn.map((e=>[...e].reverse()))),f=()=>T(b.cellsByRow),E=()=>T(b.cellsByRow.map((e=>[...e].reverse()))),T=e=>e.some((e=>e.some(((t,l)=>{if(0==l)return!1;if(null==t.tile)return!1;return e[l-1].canAccept(t.tile)})))),b=new class{#o;constructor(e){e.style.setProperty("--grid-size",4),e.style.setProperty("--cell-size","15vmin"),e.style.setProperty("--cell-gap","2vmin"),this.#o=i(e).map(((e,t)=>new l(e,t%4,Math.floor(t/4))))}get cellsByColumn(){return this.#o.reduce(((e,t)=>(e[t.x]=e[t.x]||[],e[t.x][t.y]=t,e)),[])}get cellsByRow(){return this.#o.reduce(((e,t)=>(e[t.y]=e[t.y]||[],e[t.y][t.x]=t,e)),[])}get cells(){return this.#o}get#c(){return this.#o.filter((e=>null==e.tile))}randomEmptyCell(){const e=Math.floor(Math.random()*this.#c.length);return this.#c[e]}}(o);b.randomEmptyCell().tile=new n(o),b.randomEmptyCell().tile=new n(o),c();
//# sourceMappingURL=index.20c6d3fe.js.map
