const e=e=>{q.innerHTML=e?"You win :)":"You lose :(",W.classList.remove(X),D.innerHTML=`Your score:  ${E}`},t=["#a7d0cd","#b8c0b8","#bfb2a7","#c1a49a","#bf988f","#b98c86","#b18180","#a7787c","#9a6f7a","#8c6779","#7b6079"];class l{#e;#t;#l;#n;constructor(e,t=(Math.random()>.5?V:2*V)){this.#e=document.createElement("div"),this.#e.classList.add("tile"),this.#e.setAttribute("id","tile"),e.append(this.#e),this.value=t}set x(e){this.#t=e,this.#e.style.setProperty("--x",e)}set y(e){this.#l=e,this.#e.style.setProperty("--y",e)}get value(){return this.#n}set value(e){this.#n=e,this.#e.textContent=e;const l=Math.log2(e),n=Math.floor(l);this.#e.style.setProperty("background-color",t[n-1]),n>=8&&this.#e.style.setProperty("color","#F5F5F5"),3==O?(this.#e.style.setProperty("border-radius","8vmin"),this.#e.style.setProperty("font-size","6vmin")):4==O?(this.#e.style.setProperty("border-radius","6vmin"),this.#e.style.setProperty("font-size","5vmin")):5==O&&(this.#e.style.setProperty("border-radius","5vmin"),this.#e.style.setProperty("font-size","4vmin"))}remove(){this.#e.remove()}waitForTransition(e=!1){return new Promise((t=>{this.#e.addEventListener(e?"animationend":"transitionend",t,{once:!0})}))}}let n,s=0;const i=()=>{_.classList.toggle(X),z.classList.toggle(X),x.classList.toggle(X),Y.classList.toggle(X),n=new L(k,O);let e=new l(k);return s=e.value,n.randomEmptyCell().tile=e,e=new l(k),s=Math.max(s,e.value),n.randomEmptyCell().tile=e,F.innerHTML=`Max tile: ${s}`,n},r=async t=>{let i;switch("object"==typeof t?i=t.key:"string"==typeof t&&(i=t),i){case"ArrowUp":if(!u())return void ee();await o();break;case"ArrowDown":if(!g())return void ee();await c();break;case"ArrowLeft":if(!h())return void ee();await a();break;case"ArrowRight":if(!y())return void ee();await d();break;default:return void ee()}if(n.cells.forEach((e=>{let t=e.mergeTiles(s);"number"==typeof t&&(s=t)})),!W.classList.contains(X))return void(D.innerHTML=`Your score:  ${E}`);const r=new l(k);s=Math.max(s,r.value),F.innerHTML=`Max tile: ${s}`,n.randomEmptyCell().tile=r,te[0].length=0,te[1].length=1,u()||g()||h()||y()?ee():r.waitForTransition(!0).then((()=>{e(!1)}))},o=()=>{m(n.cellsByColumn)},a=()=>{m(n.cellsByRow)},c=()=>{m(n.cellsByColumn.map((e=>[...e].reverse())))},d=()=>{m(n.cellsByRow.map((e=>[...e].reverse())))},m=e=>Promise.all(e.flatMap((e=>{const t=[];for(let l=1;l<e.length;l++){const n=e[l];if(null==n.tile)continue;let s;for(let t=l-1;t>=0;t--){const l=e[t];if(!l.canAccept(n.tile))break;s=l}null!=s&&(t.push(n.tile.waitForTransition()),null!=s.tile?s.mergeTile=n.tile:s.tile=n.tile,n.tile=null)}return t}))),u=()=>v(n.cellsByColumn),g=()=>v(n.cellsByColumn.map((e=>[...e].reverse()))),h=()=>v(n.cellsByRow),y=()=>v(n.cellsByRow.map((e=>[...e].reverse()))),v=e=>e.some((e=>e.some(((t,l)=>{if(0==l)return!1;if(null==t.tile)return!1;return e[l-1].canAccept(t.tile)}))));let E=0;const p=document.getElementById("score");class f{#s;#t;#l;#i;#r;constructor(e,t,l){this.#s=e,this.#t=t,this.#l=l}get x(){return this.#t}get y(){return this.#l}get tile(){return this.#i}get mergeTile(){return this.#r}set mergeTile(e){this.#r=e,null!=e&&(this.#r.x=this.#t,this.#r.y=this.#l)}set tile(e){this.#i=e,null!=e&&(this.#i.x=this.#t,this.#i.y=this.#l)}canAccept(e){return null==this.tile||null==this.mergeTile&&this.tile.value===e.value}mergeTiles(t){if(null==this.mergeTile||null==this.tile)return;this.tile.value=this.tile.value+this.mergeTile.value;let l=Math.max(t,this.tile.value);return F.innerHTML=`Max tile: ${l}`,"number"==typeof this.tile.value&&w(this.tile.value),this.tile.value==1024*V*Z&&e(!0),this.mergeTile.remove(),this.mergeTile=null,l}}const w=e=>{E+=e,p.innerHTML=`Score:  ${E}`};class L{#o;constructor(e,t){e.style.setProperty("--grid-size",t),e.style.setProperty("--cell-size",`${Q}vmin`),e.style.setProperty("--cell-gap","2vmin"),this.#o=T(e,t).map(((e,l)=>new f(e,l%t,Math.floor(l/t))))}get cellsByColumn(){return this.#o.reduce(((e,t)=>(e[t.x]=e[t.x]||[],e[t.x][t.y]=t,e)),[])}get cellsByRow(){return this.#o.reduce(((e,t)=>(e[t.y]=e[t.y]||[],e[t.y][t.x]=t,e)),[])}get cells(){return this.#o}get#a(){return this.#o.filter((e=>null==e.tile))}randomEmptyCell(){const e=Math.floor(Math.random()*this.#a.length);return this.#a[e]}}const T=(e,t)=>{const l=[];for(let n=0;n<t*t;n++){const t=document.createElement("div");t.classList.add("cell"),t.setAttribute("id","cell"),l.push(t),e.append(t)}return l},b=()=>{R.classList.toggle(X),$.classList.toggle(X),_.classList.toggle(X)},B=document.getElementById("body"),M=document.getElementById("nav"),x=(document.querySelector("#darktheme"),document.getElementById("main")),I=document.getElementById("title"),k=document.getElementById("game-board"),A=Array.from(document.querySelectorAll('input[name="gridSize"]')),P=(Array.from(document.querySelectorAll('input[name="baseNumber"]')),document.getElementById("darkmode")),C=document.getElementById("rangeInput"),H=document.getElementById("rangeBubble"),_=document.getElementById("openSettings"),S=document.getElementById("closeSettings"),$=document.getElementById("tapToStart"),R=document.getElementById("settings-board"),z=document.getElementById("starter-board"),F=(document.getElementById("score"),document.getElementById("maxtile")),Y=document.getElementById("nav__data"),W=(document.getElementById("tile"),document.getElementById("endgame__board")),q=document.getElementById("endgame__title"),D=document.getElementById("endgame__score"),U=document.getElementById("endgame__button"),X="hidden",j="background--dark-mode",N="text--dark-mode",G="elevation1--dark-mode",J="elevation2--dark-mode";let K="",O=4,Q=15,V=2,Z=1;_.addEventListener("click",(function(){b(),(()=>{H.innerHTML=C.value;const e=C.offsetWidth/10*C.value-C.offsetWidth/10+4;H.style.left=`${e}px`})()})),S.addEventListener("click",b),$.addEventListener("click",(function(){K=i(),ee(),le()})),window.addEventListener("keyup",(e=>{"Space"!=e.code&&"Enter"!=e.code||(i(),ee(),le())})),C.addEventListener("input",(()=>{H.innerHTML=C.value;const e=C.offsetWidth/10*C.value-C.offsetWidth/10+4;H.style.left=`${e}px`,V=parseInt(C.value),I.innerHTML=1024*V*Z}));for(let e of A)e.addEventListener("click",(t=>{O=e.value,3==e.value?(O=3,Q=window.screen.width>1024?18:24,Z=.125,I.innerHTML=1024*V*Z):4==e.value?(O=4,Q=window.screen.width>1024?15:18,Z=1,I.innerHTML=1024*V*Z):5==e.value&&(O=5,Q=window.screen.width>1024?11:14,Z=1,I.innerHTML=1024*V*Z)}));P.addEventListener("click",(()=>{B.classList.toggle(j),M.classList.toggle(N),k.classList.toggle(G),z.classList.toggle(N),R.classList.toggle(G),R.classList.toggle(N),_.classList.toggle(N),W.classList.toggle(J),W.classList.toggle(N),U.classList.toggle(J),U.classList.toggle(N)}));const ee=()=>{window.addEventListener("keydown",r,{once:!0})};var te=[[],[]];const le=()=>{window.addEventListener("touchstart",(function(e){te[0][0]=e.changedTouches[0].screenX,te[1][0]=e.changedTouches[0].screenY})),window.addEventListener("touchend",(function(e){te[0][1]=e.changedTouches[0].screenX,te[1][1]=e.changedTouches[0].screenY;const t=(()=>{const e=te[0][1]-te[0][0],t=te[1][1]-te[1][0];return Math.abs(e)>Math.abs(t)?e>0?"ArrowRight":"ArrowLeft":t>0?"ArrowDown":"ArrowUp"})();r(t)}))};
//# sourceMappingURL=index.2bcc1ff4.js.map
